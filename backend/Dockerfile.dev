# Stage 1: Build TypeScript
FROM node:22 AS builder
WORKDIR /backend

# Copy package files
COPY package*.json tsconfig.json ./
COPY prisma ./prisma

# Install ALL dependencies (including Prisma CLI)
RUN npm ci

# Copy source
COPY src ./src
COPY .env ./

# Build TypeScript
RUN npx tsc -b

# Expose port
EXPOSE 3000

# Start app
CMD ["node", "dist/index.js"]